#选择基础镜像
FROM gcc:12.2.0 AS builder

# 设置工作目录（容器内的路径）
WORKDIR /app

# 复制源代码到容器中
# 第一个参数是宿主机路径，第二个是容器内路径
COPY src/ ./src/
COPY include/ ./include/ 

# 创建构建目录
RUN mkdir build

# 设置工作目录到 build
WORKDIR /app/build

# 编译 C++ 程序
# -o 指定输出文件名
RUN g++ -o myapp ../src/main.cpp

# 第二阶段：运行阶段（使用更小的基础镜像）
FROM ubuntu:22.04

# 安装运行时可能需要的库
# -y 自动确认安装
RUN apt-get update && apt-get install -y \
    libstdc++6 \
    && rm -rf /var/lib/apt/lists/*

# 设置工作目录
WORKDIR /root/

# 从构建阶段复制编译好的可执行文件
COPY --from=builder /app/build/myapp .

# 设置容器启动时执行的命令
CMD ["./myapp"]